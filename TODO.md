## TODO LIST

- [x] 电柜激活电池(需要注意判定库存是否充足)
- [x] 门店退租电车入库(门店扫码)
- [x] 后台强制退租车电
- [x] 单电激活 - 门店推送合同
- [x] 单电激活 - 骑手自主扫码激活 (待测试)
- [x] 后台激活车电或单电推送合同 (仅针对门店, 不可以选择电柜)
- [x] 后台换绑电车 (需要将原有电车入库到指定门店并解绑, 然后绑定新的电车)
- [x] 后台车辆列表显示状态 / 门店 / 骑手
- [x] 骑手列表筛选电池型号 / 车辆型号
- [x] !!!签约推送更改为HTTP, App请求并调用web api!!!
- [x] 合同生成后, 重新生成合同无任何返回
- [x] 骑士卡冲突 (如:72V26AH, 车电设置过, 单电会冲突)
- [x] 导入骑手支持电车订阅并且免签约直接激活
- [x] 骑手列表显示电车型号和车架号
- [x] 门店物资新增筛选: 选择电池型号 / 选择电车型号选择 / 其他物资名称
- [x] 团签用户激活新流程
- [x] 团签后台激活免签约
- [ ] 给骑手分配骑士卡
- [ ] 开启设备校验时, 更新数据库强制设置所有用户的新设备为`false`
- [x] 删除用户重新登录后请求的是老用户信息
- [x] APP版本号读取设置
- [x] 用户花费赠送积分根据城市区分不同的赠送比例
- [ ] 积分使用更聪明的办法锁定
- [x] 合同列表管理(筛选骑手 / 签约状态 / 是否有效 / 签约时间)
- [x] 用户自主扫码激活但取消后, 使用门店激活, 库存信息会错误的携带门店信息, 导致出库既有门店又有电柜
- [ ] 新设定(`env`)
- [ ] 启动后自动进行合同下载
- [ ] 每个月更新订阅不影响续费(现在有可能会因为禁用订阅导致找不到原来的骑士卡从而无法续费, 1.3.3支付改为前端发起, 并提示用户必须更新)
- [x] 扫电柜签约超过10分钟导致分配信息过期, 设想解决方案为: 电柜激活时, 不限制分配信息状态, 电柜激活成功后修改分配信息
- [ ] 删除用户记录日志
- [ ] 电柜信息同步
- [ ] 记录用户扫码失败信息(换电过程中或电柜繁忙的时候用户扫码也记录)
- [ ] 用户使用详细日志(包含用户信息)
- [ ] 确定智能电池满电电量
- [ ] 智能柜不用旧轮询
- [ ] 智能柜套餐冲突判定
- [ ] 同步电池, 若电池不存在, 则自动添加电池
- [ ] 电池取出或失联通知服务器和电柜脱离
- [ ] 分配信息是否需要记录电池编号
- [ ] 智能电池业务记录
- [ ] 智能电池出入库记录
- [ ] 智能电池是否需要电柜调拨初始化 (app/service/rider_business.go#L63)
- [ ] 业务操作失败后电池信息是否更新, 例如A拿着B的电池换电或退租
- [ ] 后台库存统计排除和区分智能电池
- [ ] [激活]和[取消寄存]业务时, 原有逻辑是: 默认记录业务状态为完成并标记为业务成功, 智能柜套餐业务时如果失败需要后续逻辑修复 (取出电池滞后执行)
- [ ] 自动更新
- [ ] 智能套餐后台激活时, 需要绑定电池
- [ ] 非智能套餐禁止在智能柜换电和办理业务
- [ ] 绑定电池时, 需要进行城市限定, 并且, 在电柜中的电池无法直接从后台绑定
- [ ] 远程请求最新电柜数据
- [ ] 仓控或其他电柜数据请求时, 直接请求新的智能柜系统, 抛弃老的电柜系统. 例如: 电柜列表中不显示智能柜, 智能柜列表管理使用新的系统
- [ ] 为啥有两条寄存信息 `subscribe_id = 115964117567|124554055925`
- [ ] 可配置：按城市自然日（或小时）配置用户一定时间段内（动态）换电次数若大于等于某个阈值，则使用不同的换电间隔, 可给某个用户单独配置换电间隔阶梯
- [x] 删除MongoDB
- [ ] 按条件撤回已发送优惠券
- [ ] 电池流转记录存储在电池微服务中, (主业务服务和电柜服务告知电池服务当前归属人, 电池存储心跳数据时记录归属人)
- [ ] 后台新增操作: 换电立即超时
- [ ] 电柜未操作开门, 电池失联立即锁仓


```sql
INSERT INTO "public"."subscribe_pause"("id","created_at","updated_at","deleted_at","creator","last_modifier","remark","start_at","end_at","days","subscribe_id","rider_id","employee_id","end_employee_id","end_modifier","city_id","store_id","end_store_id","cabinet_id","end_cabinet_id","overdue_days","pause_overdue","suspend_days")
VALUES
(124554054387,E'2023-01-10 21:27:37.30464+08',E'2023-01-10 21:27:37.304641+08',NULL,NULL,NULL,NULL,E'2023-01-10 21:27:37.304638+08',NULL,NULL,115964117567,98784248510,NULL,NULL,NULL,410100,NULL,NULL,17179869463,NULL,0,FALSE,0),
(124554054386,E'2023-01-10 21:27:37.195824+08',E'2023-01-28 11:53:57.767333+08',NULL,NULL,NULL,NULL,E'2023-01-10 21:27:37.195822+08',NULL,17,115964117567,98784248510,NULL,NULL,NULL,410100,NULL,NULL,17179869463,NULL,0,FALSE,0); 
```

## 注意

- TODO DEBUG START