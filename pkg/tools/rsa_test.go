// Copyright (C) liasica. 2024-present.
//
// Created at 2024-03-03
// Based on aurservd by liasica, magicrolan@qq.com.

package tools

import (
	"encoding/base64"
	"fmt"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestRSA(t *testing.T) {
	der, err := base64.StdEncoding.DecodeString("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")
	require.NoError(t, err)
	k, _ := NewRsa(der)
	message := "Hello, RSA!"
	encrypted, err := k.Encrypt([]byte(message))
	require.NoError(t, err)

	decrypted, err := k.Decrypt(encrypted)
	require.NoError(t, err)

	require.Equal(t, message, string(decrypted))

	str := "sNjfred0EcqvSJQNgJSjihUnheJhZdf8SH2sJiMVmT6f3sFMkDozvM/BgtIkEON2ueUL1lqqdeeuaFhBZoeUPoitT3xopfEFPCMppifkE7G/yrYNggAOTN3z5wlTpJCgc/g3o6WFe6goWfB1EwUDLu/j6fwNHsON0zPmM0nGQQipSn/2M/nCF0/eRR+b+M0QWuQ8vjKI1/+89/0nokjHTrc16WUgl7V3FjJuwWvqdkz6rNUrF9MpQ+AxPCMu1jQ5cTF2NN3/AYCF0zc75Y310YuXtaPWvFQRxbLUFsx4dc3cEdmbiKfkwh/aVdEUHG1yFuBXqJDk6+y3BniRWqfQeRGOdw50mhP58a4ZpGsmQkss035zwJbGlWV6e4pUN7tXxKcHdxiviin241NEDMbobpfmvEOotiTJZWfq/tKXW3b5/VYqK3NhIPXmRShsgh/hmUkQvNhkFsY4X9wNGtbBxn4AqNYsOpcRKzknGhN8m43+3i7Mbg1Q7kh+CIsJNReFgvgO0bkr402Cp3UAR7FtyKeMY7GcQ+C5Yg9ohGg1GUA5nyfdOihc1L9EnxwpYmlkuyPXdsx180WQbOPuC/V9ivOrmLE/WvD4lNA0Eq1jfIiGSzRKkMV9uvP611s1xEQVRFqfubJT//hM2k0ru8ZMq+G25X+ApZD85qFLtBUcJ8s="
	encrypted, _ = base64.StdEncoding.DecodeString(str)
	decrypted, err = k.Decrypt(encrypted)
	require.NoError(t, err)
	fmt.Println(string(decrypted))
}
